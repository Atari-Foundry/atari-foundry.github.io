<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><title data-next-head="">iocb-structure | forge Documentation | Atari Foundry</title><meta name="description" content="forge documentation: iocb-structure" data-next-head=""/><link rel="preload" href="/images/foundry_logo_50H.png" as="image" data-next-head=""/><link rel="preload" href="/_next/static/chunks/c81f129e50a5fd79.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/c81f129e50a5fd79.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/e8a4a4ae55bc5744.js" defer=""></script><script src="/_next/static/chunks/00dac80f236dcabb.js" defer=""></script><script src="/_next/static/chunks/44f6bc00d9aaf830.js" defer=""></script><script src="/_next/static/chunks/fd7cb30d70431a0f.js" defer=""></script><script src="/_next/static/chunks/turbopack-4769270d21ef6607.js" defer=""></script><script src="/_next/static/chunks/1b081b821847ed60.js" defer=""></script><script src="/_next/static/chunks/39b01aa8a3352426.js" defer=""></script><script src="/_next/static/chunks/b56fd671c61106a7.js" defer=""></script><script src="/_next/static/chunks/turbopack-ab1a8023ffca1f9c.js" defer=""></script><script src="/_next/static/uKcVMkypfjITnNYGcdC5l/_ssgManifest.js" defer=""></script><script src="/_next/static/uKcVMkypfjITnNYGcdC5l/_buildManifest.js" defer=""></script></head><body><div id="__next"><div class="crt"><div class="scanlines" aria-hidden="true"></div><div class="noise" aria-hidden="true"></div><nav class="nav"><a class="nav-brand" href="/"><img alt="Atari Foundry icon" width="72" height="50" decoding="async" data-nimg="1" style="color:transparent;height:40px;width:auto" src="/images/foundry_logo_50H.png"/><div><span class="nav-brand-title">Atari Foundry</span><span class="nav-brand-sub">Products for Atari 8-bit</span></div></a><ul class="nav-links"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/vault">Vault</a></li><li class="nav-item has-children"><button type="button" class="nav-link nav-trigger active" aria-haspopup="true" aria-expanded="false">Docs</button><div class="nav-dropdown"><a class="nav-dropdown-link" href="/docs/crucible">Crucible</a><a class="nav-dropdown-link" href="/docs/atrforge">atrforge</a><a class="nav-dropdown-link" href="/docs/forge">FORGE</a></div></li><li class="nav-item"><a class="nav-link" href="/support">Support</a></li></ul></nav><header class="subhero"><p class="label">forge<!-- --> Documentation</p><h1 class="page-title">iocb-structure</h1></header><main><div class="docs-layout"><aside class="docs-sidebar"><nav class="docs-nav"><div class="docs-nav-section"><h3>Documentation</h3><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:0rem" href="/docs/forge/readme">README</a></li><li><a class="doc-link " style="padding-left:0rem" href="/docs/forge/index">index</a></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">cc65</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/cc65">README</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">about</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/about/attributions">attributions</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/about/why-forge">why-forge</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">advanced topics</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/cio-reference">cio-reference</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/display-list-interrupts">display-list-interrupts</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/fujinet">fujinet</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/low-level-programming">low-level-programming</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/note-point">note-point</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/sio-operations">sio-operations</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/advanced-topics/xio-reference">xio-reference</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">getting started</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/getting-started/compiling">compiling</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/getting-started/differences">differences</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/getting-started/first-steps">first-steps</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/getting-started/introduction">introduction</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">editor</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/editor/editor-guide">editor-guide</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/editor/editor-optimization">editor-optimization</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">language reference</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/language-reference/expressions">expressions</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/language-reference/functions">functions</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/language-reference/statements">statements</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/language-reference/syntax">syntax</a></li></ul></div></li><li><div class="docs-nav-section" style="margin-top:0"><h4 style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.15em;color:rgba(255, 255, 255, 0.5);margin-bottom:0.6rem;font-weight:700;padding-left:0rem">reference</h4><ul style="list-style:none;padding:0;margin:0"><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/hardware-registers">hardware-registers</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/interrupts">interrupts</a></li><li><a class="doc-link active" style="padding-left:1.2rem" href="/docs/forge/reference/iocb-structure">iocb-structure</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/memory-map">memory-map</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/memory-usage">memory-usage</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/os-equates">os-equates</a></li><li><a class="doc-link " style="padding-left:1.2rem" href="/docs/forge/reference/r-handler">r-handler</a></li></ul></div></li></ul></div></nav></aside><div class="docs-content"><div class="docs-body"><div class="doc-markdown"><h1>IOCB Structure</h1>
<p>Input/Output Control Block (IOCB) structure and usage reference.</p>
<h2>Overview</h2>
<p>Atari&#x27;s CIO (Central Input/Output) uses IOCBs to remember everything about an open &quot;file/device handle&quot; — what device it is, its status, where the buffer is, etc.</p>
<p>There are 8 IOCBs, numbered 0-7. Each IOCB is 16 bytes long.</p>
<h2>IOCB Addresses</h2>
<p>IOCB 0 starts at address $0340 (decimal 832). Each subsequent IOCB is 16 bytes later:</p>
<ul>
<li><strong>IOCB 0:</strong> $0340-$034F (832-847)</li>
<li><strong>IOCB 1:</strong> $0350-$035F (848-863)</li>
<li><strong>IOCB 2:</strong> $0360-$036F (864-879)</li>
<li><strong>IOCB 3:</strong> $0370-$037F (880-895)</li>
<li><strong>IOCB 4:</strong> $0380-$038F (896-911)</li>
<li><strong>IOCB 5:</strong> $0390-$039F (912-927)</li>
<li><strong>IOCB 6:</strong> $03A0-$03AF (928-943)</li>
<li><strong>IOCB 7:</strong> $03B0-$03BF (944-959)</li>
</ul>
<h2>IOCB Byte Layout</h2>
<h3>IOCB 1 Layout (848-863)</h3>
<p>Here&#x27;s what each byte means for IOCB 1 (most commonly used):</p>
<table><thead><tr><th>Addr (dec)</th><th>Addr (hex)</th><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td>848</td><td>$0350</td><td>ICHID</td><td>Handler ID (0 = closed, nonzero = open)</td></tr><tr><td>849</td><td>$0351</td><td>ICDNO</td><td>Device number (R1:, D2:, etc)</td></tr><tr><td>850</td><td>$0352</td><td>ICCOM</td><td>CIO command code (OPEN, GET, PUT, CLOSE, STATUS…)</td></tr><tr><td>851</td><td>$0353</td><td>ICSTA</td><td>Status from last CIO operation (success or error code)</td></tr><tr><td>852</td><td>$0354</td><td>ICBAL</td><td>Buffer address (low byte)</td></tr><tr><td>853</td><td>$0355</td><td>ICBAH</td><td>Buffer address (high byte)</td></tr><tr><td>854</td><td>$0356</td><td>ICPTL</td><td>Current data pointer (low byte)</td></tr><tr><td>855</td><td>$0357</td><td>ICPTH</td><td>Current data pointer (high byte)</td></tr><tr><td>856</td><td>$0358</td><td>ICBLL</td><td>Buffer length (low byte)</td></tr><tr><td>857</td><td>$0359</td><td>ICBLH</td><td>Buffer length (high byte)</td></tr><tr><td>858</td><td>$035A</td><td>ICAX1</td><td>AUX1 (your OPEN 2nd parameter → 12)</td></tr><tr><td>859</td><td>$035B</td><td>ICAX2</td><td>AUX2 (your OPEN 3rd parameter → 0)</td></tr><tr><td>860</td><td>$035C</td><td>ICAX3</td><td>AUX3 (device-specific)</td></tr><tr><td>861</td><td>$035D</td><td>ICAX4</td><td>AUX4 (device-specific)</td></tr><tr><td>862</td><td>$035E</td><td>ICAX5</td><td>AUX5 (device-specific)</td></tr><tr><td>863</td><td>$035F</td><td>ICAX6</td><td>AUX6 (device-specific)</td></tr></tbody></table>
<h2>IOCB Field Descriptions</h2>
<h3>ICHID (Handler Identifier)</h3>
<p>When a channel is open, the handler I.D. contains an index to the handler table. The handler table holds the address of the device handling routines. When the channel is closed ICHID contains $FF.</p>
<p><strong>After OPEN #1,12,0,&quot;R:&quot;:</strong></p>
<ul>
<li>ICHID becomes non-zero → &quot;this channel is open&quot;</li>
</ul>
<h3>ICDNO (Device Number)</h3>
<p>The device number is used to distinguish between multiple devices with the same name, such as disk drives.</p>
<ul>
<li>R1: = device number 1</li>
<li>D2: = device number 2</li>
</ul>
<h3>ICCOM (Command)</h3>
<p>The command byte tells CIO what operation to perform.</p>
<p><strong>Common commands:</strong></p>
<ul>
<li>$03 = OPEN</li>
<li>$05 = GET RECORD (INPUT)</li>
<li>$07 = GET CHARACTER</li>
<li>$09 = PUT RECORD (PRINT)</li>
<li>$0B = PUT CHARACTER</li>
<li>$0C = CLOSE</li>
<li>$0D = STATUS</li>
</ul>
<h3>ICSTA (Status)</h3>
<p>ICSTA (IOCB status byte) is the result code from the last CIO operation done on that IOCB.</p>
<p><strong>Location:</strong> 851 decimal = $0353 (for IOCB1)</p>
<p><strong>Meaning:</strong></p>
<ul>
<li><strong>0 = OK / Success</strong> - If the last CIO call worked, PEEK(851) will almost always be 0</li>
</ul>
<p><strong>Non-fatal / end-of-data:</strong></p>
<ul>
<li><strong>136 ($88) = End of File (EOF)</strong> - You&#x27;ll hit this reading disk files</li>
<li><strong>137 ($89) = Truncated record / line too long</strong> - Typical when using record/line input and the buffer was too short</li>
</ul>
<p><strong>Fatal errors (128-255):</strong></p>
<ul>
<li>Bad IOCB / channel not open</li>
<li>Device/handler not found</li>
<li>Bad command</li>
<li>Invalid parameter</li>
<li>Timeout</li>
<li>Device NAK / not responding</li>
<li>Framing / overrun errors (serial)</li>
</ul>
<p><strong>Interpreting ICSTA:</strong></p>
<pre><pre class="language-basic"><code class="language-basic">&#x27; Simple check
S = PEEK(851)
IF S = 0 THEN ? &quot;OK&quot; ELSE ? &quot;ERROR/STATUS=&quot;; S

&#x27; With EOF handling
S = PEEK(851)
IF S = 0 THEN ? &quot;OK&quot;
IF S = 136 THEN ? &quot;EOF&quot;
IF S &gt; 127 AND S &lt;&gt; 136 THEN ? &quot;ERROR=&quot;; S
</code></pre></pre>
<h3>ICBAL and ICBAH (Buffer Address)</h3>
<p>Before a channel is opened, the buffer address bytes are set to point to the block of memory which contains the name of the device the channel is to be opened to. Before actual input or output these bytes are set to point to the block of memory where the I/O data is stored or is to be stored.</p>
<p><strong>Reading buffer address:</strong></p>
<pre><pre class="language-basic"><code class="language-basic">BUF = PEEK(852) + 256*PEEK(853)  &#x27; ICBAL + ICBAH*256
</code></pre></pre>
<p>For some devices (including many R: handlers), these might be 0 or point to an internal buffer depending on how that handler implements I/O.</p>
<h3>ICPTL and ICPTH (Put Routine Pointer)</h3>
<p>The put routine pointer is set by CIO to point to the handler&#x27;s put-byte routine. When the channel is closed the pointer points to the IOCB-closed routine. This pointer is only used by BASIC.</p>
<p><strong>Reading pointer:</strong></p>
<pre><pre class="language-basic"><code class="language-basic">PTR = PEEK(854) + 256*PEEK(855)  &#x27; ICPTL + ICPTH*256
</code></pre></pre>
<h3>ICBLL and ICBLH (Buffer Length)</h3>
<p>The buffer length bytes show the number of bytes in the block of memory used to store the input or output data. If the amount of data read during an input operation is less than the length of the buffer, the number of bytes actually read will be put in ICBLL and ICBLH by CIO.</p>
<p><strong>Reading buffer length:</strong></p>
<pre><pre class="language-basic"><code class="language-basic">LEN = PEEK(856) + 256*PEEK(857)  &#x27; ICBLL + ICBLH*256
</code></pre></pre>
<h3>ICAX1 through ICAX6 (Auxiliary Bytes)</h3>
<p>The auxiliary information bytes are used to give CIO or the device any special information needed.</p>
<p><strong>After OPEN #1,12,0,&quot;R:&quot;:</strong></p>
<ul>
<li>ICAX1 (858) becomes 12 (because you passed 12)</li>
<li>ICAX2 (859) becomes 0</li>
</ul>
<h2>Inspecting IOCB1</h2>
<pre><pre class="language-basic"><code class="language-basic">OPEN #1,12,0,&quot;R:&quot;
FOR I=848 TO 863
  ? I, PEEK(I)
NEXT I
</code></pre></pre>
<h2>Why IOCBs Exist</h2>
<p>CIO needs a per-channel &quot;state block&quot; so it can do:</p>
<pre><pre class="language-basic"><code class="language-basic">GET #1,A$
PUT #1,&quot;HELLO&quot;
CLOSE #1
</code></pre></pre>
<p>...without you having to re-describe the device every time.</p>
<h2>Channel Usage</h2>
<h3>BASIC Channel Assignments</h3>
<table><thead><tr><th>Channel</th><th>Assignment</th></tr></thead><tbody><tr><td>0</td><td>Permanently assigned to the screen editor</td></tr><tr><td>6</td><td>Used for graphics commands</td></tr><tr><td>7</td><td>Used for the Cassette, disk and printer</td></tr></tbody></table>
<p>Channels 6 and 7 are free to use when they are not being used by BASIC. With machine language, all of the channels are available to the programmer.</p>
<h2>Common Patterns</h2>
<h3>Checking if Channel is Open</h3>
<pre><pre class="language-basic"><code class="language-basic">IF PEEK(848) &lt;&gt; 255 THEN ? &quot;Channel 1 is open&quot;
</code></pre></pre>
<h3>Reading Status</h3>
<pre><pre class="language-basic"><code class="language-basic">STATUS #1, ST
IF PEEK(851) = 0 THEN ? &quot;Last operation succeeded&quot;
</code></pre></pre>
<h3>Getting Buffer Information</h3>
<pre><pre class="language-basic"><code class="language-basic">BUF_ADDR = PEEK(852) + 256*PEEK(853)
BUF_LEN = PEEK(856) + 256*PEEK(857)
? &quot;Buffer at &quot;; BUF_ADDR; &quot; length &quot;; BUF_LEN
</code></pre></pre>
<h2>Related Topics</h2>
<ul>
<li><a node="[object Object]" href="/docs/forge/reference/advanced-topics/cio-reference">CIO Reference</a> - Central I/O operations</li>
<li><a node="[object Object]" href="/docs/forge/os-equates">OS Equates</a> - Status codes and command codes</li>
<li><a node="[object Object]" href="/docs/forge/reference/language-reference/statements">Statements</a> - FORGE I/O statements</li>
</ul></div></div></div></div></main><footer class="footer"><p>© 2026 Atari Foundry · Rick Collette · Software for Atari 8-bit builders.</p></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"product":"forge","productDocs":{"product":"forge","files":[{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/cc65/README.md","relativePath":"cc65/README.md","relativeDir":"cc65","filename":"README","slug":"readme","name":"README"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/README.md","relativePath":"README.md","relativeDir":"","filename":"README","slug":"readme","name":"README"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/about/attributions.md","relativePath":"about/attributions.md","relativeDir":"about","filename":"attributions","slug":"attributions","name":"attributions"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/cio-reference.md","relativePath":"advanced-topics/cio-reference.md","relativeDir":"advanced-topics","filename":"cio-reference","slug":"cio-reference","name":"cio-reference"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/compiling.md","relativePath":"getting-started/compiling.md","relativeDir":"getting-started","filename":"compiling","slug":"compiling","name":"compiling"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/differences.md","relativePath":"getting-started/differences.md","relativeDir":"getting-started","filename":"differences","slug":"differences","name":"differences"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/display-list-interrupts.md","relativePath":"advanced-topics/display-list-interrupts.md","relativeDir":"advanced-topics","filename":"display-list-interrupts","slug":"display-list-interrupts","name":"display-list-interrupts"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/editor/editor-guide.md","relativePath":"editor/editor-guide.md","relativeDir":"editor","filename":"editor-guide","slug":"editor-guide","name":"editor-guide"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/editor/editor-optimization.md","relativePath":"editor/editor-optimization.md","relativeDir":"editor","filename":"editor-optimization","slug":"editor-optimization","name":"editor-optimization"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/expressions.md","relativePath":"language-reference/expressions.md","relativeDir":"language-reference","filename":"expressions","slug":"expressions","name":"expressions"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/first-steps.md","relativePath":"getting-started/first-steps.md","relativeDir":"getting-started","filename":"first-steps","slug":"first-steps","name":"first-steps"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/fujinet.md","relativePath":"advanced-topics/fujinet.md","relativeDir":"advanced-topics","filename":"fujinet","slug":"fujinet","name":"fujinet"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/functions.md","relativePath":"language-reference/functions.md","relativeDir":"language-reference","filename":"functions","slug":"functions","name":"functions"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/hardware-registers.md","relativePath":"reference/hardware-registers.md","relativeDir":"reference","filename":"hardware-registers","slug":"hardware-registers","name":"hardware-registers"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/index.md","relativePath":"index.md","relativeDir":"","filename":"index","slug":"index","name":"index"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/interrupts.md","relativePath":"reference/interrupts.md","relativeDir":"reference","filename":"interrupts","slug":"interrupts","name":"interrupts"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/introduction.md","relativePath":"getting-started/introduction.md","relativeDir":"getting-started","filename":"introduction","slug":"introduction","name":"introduction"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/iocb-structure.md","relativePath":"reference/iocb-structure.md","relativeDir":"reference","filename":"iocb-structure","slug":"iocb-structure","name":"iocb-structure"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/low-level-programming.md","relativePath":"advanced-topics/low-level-programming.md","relativeDir":"advanced-topics","filename":"low-level-programming","slug":"low-level-programming","name":"low-level-programming"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/memory-map.md","relativePath":"reference/memory-map.md","relativeDir":"reference","filename":"memory-map","slug":"memory-map","name":"memory-map"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/memory-usage.md","relativePath":"reference/memory-usage.md","relativeDir":"reference","filename":"memory-usage","slug":"memory-usage","name":"memory-usage"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/note-point.md","relativePath":"advanced-topics/note-point.md","relativeDir":"advanced-topics","filename":"note-point","slug":"note-point","name":"note-point"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/os-equates.md","relativePath":"reference/os-equates.md","relativeDir":"reference","filename":"os-equates","slug":"os-equates","name":"os-equates"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/r-handler.md","relativePath":"reference/r-handler.md","relativeDir":"reference","filename":"r-handler","slug":"r-handler","name":"r-handler"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/sio-operations.md","relativePath":"advanced-topics/sio-operations.md","relativeDir":"advanced-topics","filename":"sio-operations","slug":"sio-operations","name":"sio-operations"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/statements.md","relativePath":"language-reference/statements.md","relativeDir":"language-reference","filename":"statements","slug":"statements","name":"statements"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/syntax.md","relativePath":"language-reference/syntax.md","relativeDir":"language-reference","filename":"syntax","slug":"syntax","name":"syntax"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/about/why-forge.md","relativePath":"about/why-forge.md","relativeDir":"about","filename":"why-forge","slug":"why-forge","name":"why-forge"},{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/xio-reference.md","relativePath":"advanced-topics/xio-reference.md","relativeDir":"advanced-topics","filename":"xio-reference","slug":"xio-reference","name":"xio-reference"}],"navTree":{"cc65":{"_files":[{"name":"README","slug":"readme","path":"cc65/README.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/cc65/README.md","isIndex":true}]},"_files":[{"name":"README","slug":"readme","path":"README.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/README.md","isIndex":true},{"name":"index","slug":"index","path":"index.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/index.md","isIndex":false}],"about":{"_files":[{"name":"attributions","slug":"attributions","path":"about/attributions.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/about/attributions.md","isIndex":false},{"name":"why-forge","slug":"why-forge","path":"about/why-forge.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/about/why-forge.md","isIndex":false}]},"advanced-topics":{"_files":[{"name":"cio-reference","slug":"cio-reference","path":"advanced-topics/cio-reference.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/cio-reference.md","isIndex":false},{"name":"display-list-interrupts","slug":"display-list-interrupts","path":"advanced-topics/display-list-interrupts.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/display-list-interrupts.md","isIndex":false},{"name":"fujinet","slug":"fujinet","path":"advanced-topics/fujinet.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/fujinet.md","isIndex":false},{"name":"low-level-programming","slug":"low-level-programming","path":"advanced-topics/low-level-programming.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/low-level-programming.md","isIndex":false},{"name":"note-point","slug":"note-point","path":"advanced-topics/note-point.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/note-point.md","isIndex":false},{"name":"sio-operations","slug":"sio-operations","path":"advanced-topics/sio-operations.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/sio-operations.md","isIndex":false},{"name":"xio-reference","slug":"xio-reference","path":"advanced-topics/xio-reference.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/advanced-topics/xio-reference.md","isIndex":false}]},"getting-started":{"_files":[{"name":"compiling","slug":"compiling","path":"getting-started/compiling.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/compiling.md","isIndex":false},{"name":"differences","slug":"differences","path":"getting-started/differences.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/differences.md","isIndex":false},{"name":"first-steps","slug":"first-steps","path":"getting-started/first-steps.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/first-steps.md","isIndex":false},{"name":"introduction","slug":"introduction","path":"getting-started/introduction.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/getting-started/introduction.md","isIndex":false}]},"editor":{"_files":[{"name":"editor-guide","slug":"editor-guide","path":"editor/editor-guide.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/editor/editor-guide.md","isIndex":false},{"name":"editor-optimization","slug":"editor-optimization","path":"editor/editor-optimization.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/editor/editor-optimization.md","isIndex":false}]},"language-reference":{"_files":[{"name":"expressions","slug":"expressions","path":"language-reference/expressions.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/expressions.md","isIndex":false},{"name":"functions","slug":"functions","path":"language-reference/functions.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/functions.md","isIndex":false},{"name":"statements","slug":"statements","path":"language-reference/statements.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/statements.md","isIndex":false},{"name":"syntax","slug":"syntax","path":"language-reference/syntax.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/language-reference/syntax.md","isIndex":false}]},"reference":{"_files":[{"name":"hardware-registers","slug":"hardware-registers","path":"reference/hardware-registers.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/hardware-registers.md","isIndex":false},{"name":"interrupts","slug":"interrupts","path":"reference/interrupts.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/interrupts.md","isIndex":false},{"name":"iocb-structure","slug":"iocb-structure","path":"reference/iocb-structure.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/iocb-structure.md","isIndex":false},{"name":"memory-map","slug":"memory-map","path":"reference/memory-map.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/memory-map.md","isIndex":false},{"name":"memory-usage","slug":"memory-usage","path":"reference/memory-usage.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/memory-usage.md","isIndex":false},{"name":"os-equates","slug":"os-equates","path":"reference/os-equates.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/os-equates.md","isIndex":false},{"name":"r-handler","slug":"r-handler","path":"reference/r-handler.md","fullPath":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/r-handler.md","isIndex":false}]}}},"docFile":{"path":"/home/megalith/AtariProjects/AtariFoundry/www/PROJECT_DOCS/forge/reference/iocb-structure.md","relativePath":"reference/iocb-structure.md","relativeDir":"reference","filename":"iocb-structure","slug":"iocb-structure","name":"iocb-structure","content":"# IOCB Structure\n\nInput/Output Control Block (IOCB) structure and usage reference.\n\n## Overview\n\nAtari's CIO (Central Input/Output) uses IOCBs to remember everything about an open \"file/device handle\" — what device it is, its status, where the buffer is, etc.\n\nThere are 8 IOCBs, numbered 0-7. Each IOCB is 16 bytes long.\n\n## IOCB Addresses\n\nIOCB 0 starts at address $0340 (decimal 832). Each subsequent IOCB is 16 bytes later:\n\n- **IOCB 0:** $0340-$034F (832-847)\n- **IOCB 1:** $0350-$035F (848-863)\n- **IOCB 2:** $0360-$036F (864-879)\n- **IOCB 3:** $0370-$037F (880-895)\n- **IOCB 4:** $0380-$038F (896-911)\n- **IOCB 5:** $0390-$039F (912-927)\n- **IOCB 6:** $03A0-$03AF (928-943)\n- **IOCB 7:** $03B0-$03BF (944-959)\n\n## IOCB Byte Layout\n\n### IOCB 1 Layout (848-863)\n\nHere's what each byte means for IOCB 1 (most commonly used):\n\n| Addr (dec) | Addr (hex) | Name | Meaning |\n|------------|------------|------|---------|\n| 848 | $0350 | ICHID | Handler ID (0 = closed, nonzero = open) |\n| 849 | $0351 | ICDNO | Device number (R1:, D2:, etc) |\n| 850 | $0352 | ICCOM | CIO command code (OPEN, GET, PUT, CLOSE, STATUS…) |\n| 851 | $0353 | ICSTA | Status from last CIO operation (success or error code) |\n| 852 | $0354 | ICBAL | Buffer address (low byte) |\n| 853 | $0355 | ICBAH | Buffer address (high byte) |\n| 854 | $0356 | ICPTL | Current data pointer (low byte) |\n| 855 | $0357 | ICPTH | Current data pointer (high byte) |\n| 856 | $0358 | ICBLL | Buffer length (low byte) |\n| 857 | $0359 | ICBLH | Buffer length (high byte) |\n| 858 | $035A | ICAX1 | AUX1 (your OPEN 2nd parameter → 12) |\n| 859 | $035B | ICAX2 | AUX2 (your OPEN 3rd parameter → 0) |\n| 860 | $035C | ICAX3 | AUX3 (device-specific) |\n| 861 | $035D | ICAX4 | AUX4 (device-specific) |\n| 862 | $035E | ICAX5 | AUX5 (device-specific) |\n| 863 | $035F | ICAX6 | AUX6 (device-specific) |\n\n## IOCB Field Descriptions\n\n### ICHID (Handler Identifier)\n\nWhen a channel is open, the handler I.D. contains an index to the handler table. The handler table holds the address of the device handling routines. When the channel is closed ICHID contains $FF.\n\n**After OPEN #1,12,0,\"R:\":**\n- ICHID becomes non-zero → \"this channel is open\"\n\n### ICDNO (Device Number)\n\nThe device number is used to distinguish between multiple devices with the same name, such as disk drives.\n\n- R1: = device number 1\n- D2: = device number 2\n\n### ICCOM (Command)\n\nThe command byte tells CIO what operation to perform.\n\n**Common commands:**\n- $03 = OPEN\n- $05 = GET RECORD (INPUT)\n- $07 = GET CHARACTER\n- $09 = PUT RECORD (PRINT)\n- $0B = PUT CHARACTER\n- $0C = CLOSE\n- $0D = STATUS\n\n### ICSTA (Status)\n\nICSTA (IOCB status byte) is the result code from the last CIO operation done on that IOCB.\n\n**Location:** 851 decimal = $0353 (for IOCB1)\n\n**Meaning:**\n- **0 = OK / Success** - If the last CIO call worked, PEEK(851) will almost always be 0\n\n**Non-fatal / end-of-data:**\n- **136 ($88) = End of File (EOF)** - You'll hit this reading disk files\n- **137 ($89) = Truncated record / line too long** - Typical when using record/line input and the buffer was too short\n\n**Fatal errors (128-255):**\n- Bad IOCB / channel not open\n- Device/handler not found\n- Bad command\n- Invalid parameter\n- Timeout\n- Device NAK / not responding\n- Framing / overrun errors (serial)\n\n**Interpreting ICSTA:**\n\n```basic\n' Simple check\nS = PEEK(851)\nIF S = 0 THEN ? \"OK\" ELSE ? \"ERROR/STATUS=\"; S\n\n' With EOF handling\nS = PEEK(851)\nIF S = 0 THEN ? \"OK\"\nIF S = 136 THEN ? \"EOF\"\nIF S \u003e 127 AND S \u003c\u003e 136 THEN ? \"ERROR=\"; S\n```\n\n### ICBAL and ICBAH (Buffer Address)\n\nBefore a channel is opened, the buffer address bytes are set to point to the block of memory which contains the name of the device the channel is to be opened to. Before actual input or output these bytes are set to point to the block of memory where the I/O data is stored or is to be stored.\n\n**Reading buffer address:**\n```basic\nBUF = PEEK(852) + 256*PEEK(853)  ' ICBAL + ICBAH*256\n```\n\nFor some devices (including many R: handlers), these might be 0 or point to an internal buffer depending on how that handler implements I/O.\n\n### ICPTL and ICPTH (Put Routine Pointer)\n\nThe put routine pointer is set by CIO to point to the handler's put-byte routine. When the channel is closed the pointer points to the IOCB-closed routine. This pointer is only used by BASIC.\n\n**Reading pointer:**\n```basic\nPTR = PEEK(854) + 256*PEEK(855)  ' ICPTL + ICPTH*256\n```\n\n### ICBLL and ICBLH (Buffer Length)\n\nThe buffer length bytes show the number of bytes in the block of memory used to store the input or output data. If the amount of data read during an input operation is less than the length of the buffer, the number of bytes actually read will be put in ICBLL and ICBLH by CIO.\n\n**Reading buffer length:**\n```basic\nLEN = PEEK(856) + 256*PEEK(857)  ' ICBLL + ICBLH*256\n```\n\n### ICAX1 through ICAX6 (Auxiliary Bytes)\n\nThe auxiliary information bytes are used to give CIO or the device any special information needed.\n\n**After OPEN #1,12,0,\"R:\":**\n- ICAX1 (858) becomes 12 (because you passed 12)\n- ICAX2 (859) becomes 0\n\n## Inspecting IOCB1\n\n```basic\nOPEN #1,12,0,\"R:\"\nFOR I=848 TO 863\n  ? I, PEEK(I)\nNEXT I\n```\n\n## Why IOCBs Exist\n\nCIO needs a per-channel \"state block\" so it can do:\n\n```basic\nGET #1,A$\nPUT #1,\"HELLO\"\nCLOSE #1\n```\n\n...without you having to re-describe the device every time.\n\n## Channel Usage\n\n### BASIC Channel Assignments\n\n| Channel | Assignment |\n|---------|------------|\n| 0 | Permanently assigned to the screen editor |\n| 6 | Used for graphics commands |\n| 7 | Used for the Cassette, disk and printer |\n\nChannels 6 and 7 are free to use when they are not being used by BASIC. With machine language, all of the channels are available to the programmer.\n\n## Common Patterns\n\n### Checking if Channel is Open\n\n```basic\nIF PEEK(848) \u003c\u003e 255 THEN ? \"Channel 1 is open\"\n```\n\n### Reading Status\n\n```basic\nSTATUS #1, ST\nIF PEEK(851) = 0 THEN ? \"Last operation succeeded\"\n```\n\n### Getting Buffer Information\n\n```basic\nBUF_ADDR = PEEK(852) + 256*PEEK(853)\nBUF_LEN = PEEK(856) + 256*PEEK(857)\n? \"Buffer at \"; BUF_ADDR; \" length \"; BUF_LEN\n```\n\n## Related Topics\n\n- [CIO Reference](../advanced-topics/cio-reference.md) - Central I/O operations\n- [OS Equates](os-equates.md) - Status codes and command codes\n- [Statements](../language-reference/statements.md) - FORGE I/O statements\n"},"currentPath":"reference/iocb-structure"},"__N_SSG":true},"page":"/docs/[...slug]","query":{"slug":["forge","reference","iocb-structure"]},"buildId":"uKcVMkypfjITnNYGcdC5l","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>